<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Star Dodger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #0f172a; /* Dark slate */
            font-family: 'Orbitron', sans-serif;
            touch-action: none; /* Prevent pull-to-refresh on mobile */
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* UI Overlays */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10;
        }

        .interactive {
            pointer-events: auto;
        }

        .hidden {
            display: none !important;
        }

        /* Neon Text Effects */
        .neon-text {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #0ea5e9, 0 0 30px #0ea5e9, 0 0 40px #0ea5e9;
        }

        .score-hud {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 1.5rem;
            z-index: 5;
            text-shadow: 2px 2px 0 #000;
        }

        /* Button Styles */
        .game-btn {
            background: linear-gradient(45deg, #0ea5e9, #2563eb);
            border: 2px solid #fff;
            padding: 15px 40px;
            font-size: 1.5rem;
            color: white;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.6);
            transition: transform 0.1s, box-shadow 0.1s;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 2px;
            margin-top: 20px;
        }

        .game-btn:active {
            transform: scale(0.95);
            box-shadow: 0 0 5px rgba(14, 165, 233, 0.8);
        }
        
        /* Instructions for mobile */
        .instructions {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-top: 15px;
            font-family: sans-serif;
        }

    </style>
</head>
<body>

    <!-- HUD -->
    <div id="scoreHud" class="score-hud hidden">
        SCORE: <span id="scoreVal">0</span>
    </div>

    <!-- Start Screen -->
    <div id="startScreen" class="ui-layer interactive">
        <h1 class="text-5xl md:text-7xl font-black text-white mb-2 neon-text">STAR<br>DODGER</h1>
        <p class="text-cyan-300 text-lg mb-8 tracking-widest">PILOT THE VOID</p>
        <button id="startBtn" class="game-btn">Launch</button>
        <button id="speedBtn" class="game-btn" style="margin-top: 15px; font-size: 1rem; padding: 10px 30px; background: transparent; border: 1px solid #0ea5e9; box-shadow: none;">Speed: Normal</button>
        <p class="instructions">Drag to Move â€¢ Dodge Asteroids</p>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="ui-layer interactive hidden">
        <h2 class="text-5xl font-bold text-red-500 mb-2" style="text-shadow: 0 0 20px red;">CRITICAL<br>FAILURE</h2>
        <div class="text-white text-2xl mb-6">
            FINAL SCORE<br>
            <span id="finalScore" class="text-4xl text-yellow-400 font-bold">0</span>
        </div>
        <div class="text-slate-400 text-sm mb-6">HIGH SCORE: <span id="highScore">0</span></div>
        <button id="restartBtn" class="game-btn">Retry</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    // --- Game Configuration ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Screens & UI
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const scoreHud = document.getElementById('scoreHud');
    const scoreVal = document.getElementById('scoreVal');
    const finalScoreEl = document.getElementById('finalScore');
    const highScoreEl = document.getElementById('highScore');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const speedBtn = document.getElementById('speedBtn');

    // State
    let gameRunning = false;
    let score = 0;
    let frames = 0;
    let highScore = localStorage.getItem('starDodgerHighScore') || 0;
    let difficultyMultiplier = 1;
    
    // Speed Settings
    let gameSpeedMult = 1.0; // 1.0 = Normal, 0.6 = Slow, 1.5 = Fast

    speedBtn.addEventListener('click', () => {
        if (gameSpeedMult === 1.0) {
            gameSpeedMult = 1.5;
            speedBtn.innerText = "Speed: Fast";
            speedBtn.style.color = "#fca5a5"; // Red-ish
            speedBtn.style.borderColor = "#fca5a5";
        } else if (gameSpeedMult === 1.5) {
            gameSpeedMult = 0.6;
            speedBtn.innerText = "Speed: Slow";
            speedBtn.style.color = "#86efac"; // Green-ish
            speedBtn.style.borderColor = "#86efac";
        } else {
            gameSpeedMult = 1.0;
            speedBtn.innerText = "Speed: Normal";
            speedBtn.style.color = "white";
            speedBtn.style.borderColor = "#0ea5e9";
        }
    });

    // Assets / Objects
    let player = {
        x: 0,
        y: 0,
        width: 40,
        height: 60,
        color: '#0ea5e9',
        trail: []
    };

    let asteroids = [];
    let stars = [];
    let particles = []; // For explosions

    // --- Initialization ---

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        // Reset player position to bottom center
        if (!gameRunning) {
            player.x = canvas.width / 2;
            player.y = canvas.height - 120;
        } else {
            player.y = canvas.height - 120; // Keep Y consistent on resize
        }
    }

    window.addEventListener('resize', resize);
    resize();

    // Initialize Stars (Background)
    function initStars() {
        stars = [];
        for(let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2 + 0.5,
                speed: Math.random() * 3 + 0.5
            });
        }
    }
    initStars();

    // --- Input Handling ---

    let targetX = canvas.width / 2;
    let isTouching = false;

    function handleInput(x) {
        targetX = x;
        // Clamp to screen
        if (targetX < player.width/2) targetX = player.width/2;
        if (targetX > canvas.width - player.width/2) targetX = canvas.width - player.width/2;
    }

    // Mouse
    window.addEventListener('mousemove', (e) => {
        if(gameRunning) handleInput(e.clientX);
    });

    // Touch
    window.addEventListener('touchmove', (e) => {
        if(gameRunning) {
            // e.preventDefault(); // Prevent scrolling
            handleInput(e.touches[0].clientX);
        }
    }, { passive: false });

    window.addEventListener('touchstart', (e) => {
        if(gameRunning) {
            handleInput(e.touches[0].clientX);
            isTouching = true;
        }
    }, { passive: false });
    
    window.addEventListener('touchend', () => isTouching = false);


    // --- Game Logic ---

    function startGame() {
        gameRunning = true;
        score = 0;
        frames = 0;
        difficultyMultiplier = 1;
        asteroids = [];
        particles = [];
        
        player.x = canvas.width / 2;
        player.y = canvas.height - 120;
        targetX = player.x;

        // UI updates
        startScreen.classList.add('hidden');
        gameOverScreen.classList.add('hidden');
        scoreHud.classList.remove('hidden');
        scoreVal.innerText = '0';
        
        requestAnimationFrame(gameLoop);
    }

    function gameOver() {
        gameRunning = false;
        
        // High Score Logic
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('starDodgerHighScore', highScore);
        }

        // UI updates
        finalScoreEl.innerText = score;
        highScoreEl.innerText = highScore;
        scoreHud.classList.add('hidden');
        gameOverScreen.classList.remove('hidden');

        // Explosion effect at player position
        createExplosion(player.x, player.y, 50, '#0ea5e9');
    }

    function createExplosion(x, y, count, color) {
        for (let i = 0; i < count; i++) {
            particles.push({
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 10,
                vy: (Math.random() - 0.5) * 10,
                life: 1.0,
                color: color
            });
        }
    }

    function update() {
        frames++;
        
        // Increase difficulty over time
        difficultyMultiplier = 1 + (score / 500); 

        // Player Movement (Lerp for smoothness)
        player.x += (targetX - player.x) * 0.15;

        // Player Trail
        if (frames % 3 === 0) {
            player.trail.push({ x: player.x, y: player.y + 25, life: 1.0, width: player.width });
        }

        // Update Stars (Parallax)
        stars.forEach(star => {
            star.y += star.speed * (gameRunning ? 1 : 0.2); // Move slower in menus
            if (star.y > canvas.height) {
                star.y = 0;
                star.x = Math.random() * canvas.width;
            }
        });

        if (!gameRunning) return; // Stop game logic if not running (but keep drawing stars)

        // Score
        if (frames % 10 === 0) {
            score++;
            scoreVal.innerText = score;
        }

        // Spawn Asteroids
        // Adjust spawn rate based on score AND selected game speed
        // Slower game speed = Higher number (slower spawn rate) to prevent clutter
        let baseRate = Math.max(20, 60 - Math.floor(score / 50));
        let spawnRate = Math.floor(baseRate / gameSpeedMult);
        
        if (frames % spawnRate === 0) {
            const size = Math.random() * 30 + 20;
            asteroids.push({
                x: Math.random() * (canvas.width - size * 2) + size,
                y: -50,
                size: size,
                // Reduced base speed slightly (was 3+4, now 2+3) + multiplied by setting
                speed: ((Math.random() * 2 + 3) * difficultyMultiplier) * gameSpeedMult,
                rotation: 0,
                rotSpeed: (Math.random() - 0.5) * 0.2,
                vertices: generateAsteroidShape(size)
            });
        }

        // Update Asteroids
        for (let i = asteroids.length - 1; i >= 0; i--) {
            let a = asteroids[i];
            a.y += a.speed;
            a.rotation += a.rotSpeed;

            // Collision Detection (Circle vs Rectangle approximate)
            // Using simple distance check for performance/playability
            let dx = Math.abs(a.x - player.x);
            let dy = Math.abs(a.y - player.y);

            // Hitbox is slightly smaller than visuals to be forgiving
            if (dx < (player.width/2 + a.size/2) * 0.8 && 
                dy < (player.height/2 + a.size/2) * 0.8) {
                gameOver();
            }

            // Remove off-screen
            if (a.y > canvas.height + 50) {
                asteroids.splice(i, 1);
            }
        }

        // Update Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.02;
            if (p.life <= 0) particles.splice(i, 1);
        }
        
        // Update Trail
        for (let i = player.trail.length - 1; i >= 0; i--) {
            let t = player.trail[i];
            t.y += 5; // Move trail down
            t.life -= 0.05;
            if (t.life <= 0) player.trail.splice(i, 1);
        }
    }

    function generateAsteroidShape(radius) {
        // Generate a jagged polygon
        let points = [];
        let steps = 8;
        for (let i = 0; i < steps; i++) {
            let angle = (i / steps) * Math.PI * 2;
            let r = radius * (0.8 + Math.random() * 0.4); // Variation
            points.push({
                x: Math.cos(angle) * r,
                y: Math.sin(angle) * r
            });
        }
        return points;
    }

    // --- Rendering ---

    function draw() {
        // Clear Screen
        ctx.fillStyle = '#0f172a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw Stars
        ctx.fillStyle = '#ffffff';
        stars.forEach(star => {
            ctx.globalAlpha = Math.random() * 0.5 + 0.5;
            ctx.beginPath();
            ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
            ctx.fill();
        });
        ctx.globalAlpha = 1.0;

        // Draw Player Trail (Engine Exhaust)
        player.trail.forEach(t => {
            ctx.fillStyle = `rgba(14, 165, 233, ${t.life})`;
            ctx.beginPath();
            ctx.arc(t.x, t.y, t.width * 0.4 * t.life, 0, Math.PI*2);
            ctx.fill();
        });

        if (gameRunning) {
            // Draw Player Ship
            ctx.save();
            ctx.translate(player.x, player.y);
            
            // Bank effect based on movement
            let bankAngle = (player.x - targetX) * 0.002;
            ctx.rotate(Math.max(-0.5, Math.min(0.5, bankAngle)));

            // Body
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.moveTo(0, -player.height/2); // Tip
            ctx.lineTo(player.width/2, player.height/2); // Bottom Right
            ctx.lineTo(0, player.height/2 - 10); // Engine notch
            ctx.lineTo(-player.width/2, player.height/2); // Bottom Left
            ctx.closePath();
            ctx.fill();

            // Cockpit
            ctx.fillStyle = '#bae6fd';
            ctx.beginPath();
            ctx.ellipse(0, -10, 8, 15, 0, 0, Math.PI*2);
            ctx.fill();

            // Wings details
            ctx.strokeStyle = '#7dd3fc';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, -player.height/2);
            ctx.lineTo(0, player.height/2 - 10);
            ctx.stroke();

            ctx.restore();
        }

        // Draw Asteroids
        asteroids.forEach(a => {
            ctx.save();
            ctx.translate(a.x, a.y);
            ctx.rotate(a.rotation);
            
            ctx.fillStyle = '#475569'; // Slate 600
            ctx.strokeStyle = '#94a3b8'; // Slate 400
            ctx.lineWidth = 2;

            ctx.beginPath();
            if (a.vertices.length > 0) {
                ctx.moveTo(a.vertices[0].x, a.vertices[0].y);
                for (let i = 1; i < a.vertices.length; i++) {
                    ctx.lineTo(a.vertices[i].x, a.vertices[i].y);
                }
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Highlight (fake 3D)
            ctx.fillStyle = 'rgba(255,255,255,0.1)';
            ctx.fill();

            ctx.restore();
        });

        // Draw Particles
        particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
            ctx.fill();
        });
        ctx.globalAlpha = 1.0;
    }

    // --- Loop ---

    function gameLoop() {
        update();
        draw();
        if (gameRunning || particles.length > 0) {
            requestAnimationFrame(gameLoop);
        } else {
            // Keep drawing stars in background even if stopped
             requestAnimationFrame(gameLoop);
        }
    }

    // Start initial loop for background
    requestAnimationFrame(gameLoop);

    // Button Listeners
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);

    // Prevent default touch actions
    document.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });

</script>
</body>
</html>